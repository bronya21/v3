name: Build APK with P4A

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 90
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Unzip and prepare
      run: |
        unzip -q project.zip -d .
        
    - name: Install Python-for-Android
      run: |
        sudo apt update
        sudo apt install -y python3-pip openjdk-11-jdk zlib1g-dev
        pip3 install python-for-android
        
    - name: Build APK
      run: |
        p4a apk \
          --private . \
          --package=org.bronya.warguidetalk \
          --name="WAR GUIDE TALK" \
          --version=1.0 \
          --bootstrap=sdl2 \
          --requirements=python3,kivy \
          --android-api=21 \
          --arch=arm64-v8a \
          --orientation=portrait
          
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: APK-File
        path: dist/*.apk
